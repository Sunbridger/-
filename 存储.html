<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>	cun</title>
</head>
<body>
	<script>	
/**
 * @desc 优先使用 indexedDB，在浏览器不支持indexedDB的时候使用 websql，再使用 localStorage
 *  再使用 sessionStorage， 再使用 cookie(假设存在上述情况)
 * @params key string值
 * @params value string值/object值
 */
function mySave(key,value){
	if(Object.prototype.toString.call(value)!='[object String]'){
		value = JSON.stringify(value);
	}
	if(!window.indexedDB){

	}else if(!openDatabase('data.db','1.0','demo_data',1024*1024)){

	}else if(window.localStorage){
		window.localStorage[key]=value;
	}else if(window.sessionStorage){
		window.sessionStorage[key]=value;
	}else{
		document.cookie=`${key}=${value}`
	}
}

function getSave(key){
	let res=null;
	console.log(key,'----')
	if(!window.indexedDB){

	}else if(!openDatabase('data.db','1.0','demo_data',1024*1024)){
		// ...
	}else if(window.localStorage){
		res = window.localStorage.getItem(key);
	}else if(window.sessionStorage){
		res = window.sessionStorage.getItem(key);
	}else{
		let arr = unescape(document.cookie).split("; ");
		arr.forEach(el=>{
			if(arr[i].split("=")[0]==key){
				res = arr[i].split("=")[1];
			}
		});
	}
	return res;
}
function setData(key,value){
	mySave(key,value);
	return {
		then(fn){
			fn(value)
			return this;
		}
	}
}
function getData(key){
	return {
		then(fn){
			fn(getSave(key))
		}
	}
}
setData('userData', { name : '大搜车'}).then(data => {
    console.log(data); // 输出 '大搜车'
    return getData('userData');
}).then(data => {
    console.log(data); // 输出 '大搜车'
});

	</script>
</body>
</html>